<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>局域网聊天</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#121212;color:#fff;padding:10px}
#chat{height:75vh;overflow-y:auto;background:#1e1e1e;padding:10px;border-radius:8px;margin-bottom:10px}
.msg{margin:6px 0;padding:10px;border-radius:6px;max-width:75%}
.you{background:#0066cc;margin-left:auto}
.other{background:#333}
#box{display:flex;gap:6px}
#msg{flex:1;padding:10px;border:none;border-radius:8px;background:#222;color:#fff}
#send{padding:10px 14px;background:#0066cc;color:#fff;border:none;border-radius:8px}
</style>
</head>
<body>
<div id="chat"></div>
<div id="box">
<input id="msg" placeholder="输入消息..." autocomplete="off">
<button id="send">发送</button>
</div>

<script>
const chat = document.getElementById('chat');
const msg = document.getElementById('msg');
const send = document.getElementById('send');

const username = prompt('你的名字：') || '用户';
const KEY = 'lan_chat_data';

function show(text, isYou){
  const d = document.createElement('div');
  d.className = 'msg ' + (isYou ? 'you' : 'other');
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function save(data){
  localStorage.setItem(KEY, JSON.stringify(data));
}

function load(){
  try{
    return JSON.parse(localStorage.getItem(KEY)) || [];
  }catch{return []}
}

function push(m){
  const list = load();
  list.push(m);
  save(list.slice(-50));
}

function renderAll(){
  chat.innerHTML = '';
  load().forEach(i => show(i.text, i.from == username));
}

send.onclick = () => {
  const t = msg.value.trim();
  if(!t) return;
  const data = {from:username, text:username+'：'+t};
  push(data);
  renderAll();
  msg.value = '';
}

msg.onkeydown = e => e.key == 'Enter' && send.click();

setInterval(renderAll, 800);
renderAll();
</script>
</body>
</html>
