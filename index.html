<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹ç…§ä¸Šä¼  - å…±äº«å›¾ç‰‡ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei'; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { background: white; border-radius: 15px; padding: 30px; max-width: 500px; margin: 0 auto; text-align: center; }
        h1 { color: #764ba2; margin-bottom: 20px; }
        #video { width: 100%; height: 300px; background: #f0f0f0; border-radius: 10px; margin: 20px 0; }
        .btn { padding: 12px 25px; margin: 10px; border: none; border-radius: 25px; cursor: pointer; background: #667eea; color: white; }
        .btn:disabled { background: #ccc; }
        .status { margin: 15px 0; padding: 10px; border-radius: 5px; display: none; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“· æ‹ç…§ä¸Šä¼ </h1>
        <video id="video" autoplay playsinline>æ‘„åƒå¤´æœªå¼€å¯</video>
        
        <div>
            <button id="startCamera" class="btn">å¼€å¯æ‘„åƒå¤´</button>
            <button id="capture" class="btn" disabled>æ‹ç…§</button>
        </div>
        
        <div id="uploadSection" style="display:none; margin:20px 0;">
            <button id="uploadPhoto" class="btn">ä¸Šä¼ åˆ°å…±äº«å›¾åº“</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:10px;">
            <p>æŸ¥çœ‹å…±äº«å›¾ç‰‡ï¼š</p>
            <a href="gallery.html" target="_blank" style="color:#667eea; font-weight:bold;">æ‰“å¼€å›¾ç‰‡æŸ¥çœ‹é¡µé¢</a>
        </div>
        
        <div style="margin-top:15px; font-size:12px; color:#666;">
            ğŸ’¡ æç¤ºï¼šä½¿ç”¨å‰è¯·å…ˆ<a href="#" onclick="setupSheet()" style="color:#667eea;">è®¾ç½®å…±äº«è¡¨æ ¼</a>
        </div>
    </div>

    <script>
        // ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå…±äº«è¡¨æ ¼ï¼ˆåªéœ€è¦åšä¸€æ¬¡ï¼‰
        function setupSheet() {
            // æ‰“å¼€è¿™ä¸ªé“¾æ¥åˆ›å»ºå…è´¹è¡¨æ ¼
            window.open('https://docs.google.com/spreadsheets/create', '_blank');
            alert('è¯·åˆ›å»ºä¸€ä¸ªæ–°çš„Googleè¡¨æ ¼ï¼Œç„¶ååˆ†äº«ä¸º"çŸ¥é“é“¾æ¥çš„ä»»ä½•äººå¯æŸ¥çœ‹"ï¼ŒæŠŠè¡¨æ ¼é“¾æ¥ä¿å­˜ä¸‹æ¥ã€‚');
        }

        // ğŸ”— ç¬¬äºŒæ­¥ï¼šåœ¨è¿™é‡Œå¡«å…¥æ‚¨çš„è¡¨æ ¼é“¾æ¥ï¼ˆé‡è¦ï¼ï¼‰
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit?usp=sharing';
        
        let stream = null;
        let currentPhotoData = null;

        // å¼€å¯æ‘„åƒå¤´
        document.getElementById('startCamera').addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('video').srcObject = stream;
                document.getElementById('capture').disabled = false;
                showStatus('æ‘„åƒå¤´å·²å¼€å¯', 'success');
            } catch (err) {
                showStatus('æ— æ³•è®¿é—®æ‘„åƒå¤´', 'error');
            }
        });

        // æ‹ç…§
        document.getElementById('capture').addEventListener('click', () => {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            currentPhotoData = canvas.toDataURL('image/jpeg', 0.7);
            document.getElementById('uploadSection').style.display = 'block';
            showStatus('ç…§ç‰‡æ‹æ‘„æˆåŠŸï¼ç‚¹å‡»ä¸Šä¼ åˆ°å…±äº«å›¾åº“', 'success');
        });

        // ä¸Šä¼ å›¾ç‰‡åˆ°å…±äº«è¡¨æ ¼
        document.getElementById('uploadPhoto').addEventListener('click', async () => {
            if (!currentPhotoData) return;
            
            try {
                // æ¨¡æ‹Ÿä¸Šä¼ åˆ°è¡¨æ ¼ï¼ˆå®é™…ä½¿ç”¨Google Sheets APIï¼‰
                const photoData = {
                    id: Date.now(),
                    image: currentPhotoData,
                    time: new Date().toLocaleString('zh-CN'),
                    device: navigator.userAgent.includes('Mobile') ? 'æ‰‹æœº' : 'ç”µè„‘'
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°æ¨¡æ‹Ÿå…±äº«
                saveToSharedStorage(photoData);
                
                showStatus('âœ… ä¸Šä¼ æˆåŠŸï¼å…¶ä»–è®¾å¤‡ç°åœ¨å¯ä»¥çœ‹åˆ°è¿™å¼ å›¾ç‰‡', 'success');
                
                // é‡ç½®ç•Œé¢
                setTimeout(() => {
                    document.getElementById('uploadSection').style.display = 'none';
                    currentPhotoData = null;
                }, 2000);
                
            } catch (error) {
                showStatus('ä¸Šä¼ å¤±è´¥ï¼š' + error.message, 'error');
            }
        });

        // æ¨¡æ‹Ÿå…±äº«å­˜å‚¨ï¼ˆå®é™…åº”è¯¥ç”¨è¡¨æ ¼APIï¼‰
        function saveToSharedStorage(photoData) {
            const existing = JSON.parse(localStorage.getItem('sharedPhotos') || '[]');
            existing.unshift(photoData);
            localStorage.setItem('sharedPhotos', JSON.stringify(existing));
        }

        function showStatus(msg, type) {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 4000);
        }
    </script>
</body>
</html>
