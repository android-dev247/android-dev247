<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDoS攻击监控与防御系统 | 500Gbps+实时防护</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Leaflet Extra CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', 'SF Pro Display', sans-serif;
        }
        
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #0d47a1;
            --danger-color: #e53935;
            --warning-color: #ffb300;
            --success-color: #00c853;
            --dark-bg: #0a1929;
            --darker-bg: #06121f;
            --card-bg: rgba(16, 32, 52, 0.9);
            --text-primary: #e3f2fd;
            --text-secondary: #90a4ae;
            --border-color: rgba(100, 150, 255, 0.2);
            --glow-blue: rgba(26, 115, 232, 0.7);
            --glow-red: rgba(229, 57, 53, 0.7);
            --glow-green: rgba(0, 200, 83, 0.7);
        }
        
        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 50%, #0a0f18 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* 全屏样式 */
        body.fullscreen {
            overflow: hidden;
        }
        
        body.fullscreen .container {
            padding: 0;
            max-width: 100%;
        }
        
        body.fullscreen .navbar {
            border-radius: 0;
            padding: 10px 20px;
        }
        
        body.fullscreen .main-content {
            height: calc(100vh - 70px);
            padding: 15px;
            gap: 15px;
        }
        
        body.fullscreen .map-container {
            border-radius: 10px;
        }
        
        body.fullscreen .right-panel {
            max-height: calc(100vh - 100px);
        }
        
        body.fullscreen .status-bar {
            padding: 8px 20px;
        }
        
        /* 背景粒子效果 */
        #background-particles {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }
        
        /* 攻击粒子效果容器 */
        #attack-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 100;
            pointer-events: none;
        }
        
        .attack-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            z-index: 100;
            pointer-events: none;
        }
        
        .particle-red {
            background-color: #ff3333;
            box-shadow: 0 0 10px #ff3333, 0 0 20px #ff3333;
        }
        
        .particle-orange {
            background-color: #ff9900;
            box-shadow: 0 0 10px #ff9900, 0 0 20px #ff9900;
        }
        
        .particle-purple {
            background-color: #cc33ff;
            box-shadow: 0 0 10px #cc33ff, 0 0 20px #cc33ff;
        }
        
        .particle-blue {
            background-color: #3399ff;
            box-shadow: 0 0 10px #3399ff, 0 0 20px #3399ff;
        }
        
        /* 主容器 */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        /* 顶部导航栏 */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(10, 25, 41, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 20px var(--glow-blue);
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--primary-color), #64b5f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .logo-text p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        /* 系统状态指示器 */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            background: rgba(20, 40, 80, 0.4);
            border-radius: 50px;
            border: 1px solid rgba(100, 150, 255, 0.3);
        }
        
        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: var(--success-color);
            box-shadow: 0 0 12px var(--success-color);
            animation: pulse 2s infinite;
        }
        
        .attack-detected .status-dot {
            background-color: var(--danger-color);
            box-shadow: 0 0 15px var(--danger-color);
            animation: attack-pulse 0.8s infinite;
        }
        
        .status-text {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .status-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        /* 导航栏控制按钮 */
        .navbar-controls {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 10px 16px;
            background: rgba(30, 60, 120, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .nav-btn:hover {
            background: rgba(50, 100, 200, 0.6);
            transform: translateY(-2px);
        }
        
        .nav-btn.fullscreen-btn {
            background: linear-gradient(135deg, #9c27b0, #6a1b9a);
        }
        
        .nav-btn.fullscreen-btn:hover {
            background: linear-gradient(135deg, #ba68c8, #8e24aa);
        }
        
        .nav-btn.help-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .nav-btn.help-btn:hover {
            background: linear-gradient(135deg, #ffb74d, #ff9800);
        }
        
        .nav-btn.particle-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .nav-btn.particle-btn:hover {
            background: linear-gradient(135deg, #66BB6A, #388E3C);
        }
        
        /* 主内容区域 */
        .main-content {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 25px;
            padding: 25px;
            height: calc(100vh - 90px);
            transition: all 0.3s ease;
        }
        
        /* 地图容器 */
        .map-container {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color);
            position: relative;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .map-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .map-header h2 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .map-controls {
            display: flex;
            gap: 10px;
        }
        
        .map-btn {
            padding: 8px 16px;
            background: rgba(30, 60, 120, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .map-btn:hover {
            background: rgba(50, 100, 200, 0.6);
            transform: translateY(-2px);
        }
        
        #map {
            flex-grow: 1;
            border-radius: 0 0 16px 16px;
            z-index: 1;
            position: relative;
        }
        
        /* 自定义地图标记样式 */
        .server-marker {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, var(--success-color), #00701a);
            border-radius: 50%;
            box-shadow: 0 0 25px var(--success-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            animation: server-pulse 3s infinite;
            z-index: 1000;
        }
        
        .server-marker.under-attack {
            animation: server-under-attack 1s infinite;
            box-shadow: 0 0 30px var(--danger-color);
        }
        
        .attack-marker {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, var(--danger-color), #b71c1c);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--danger-color);
            animation: attack-marker-pulse 1.5s infinite;
        }
        
        /* 攻击路径 */
        .attack-path {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, var(--danger-color), transparent);
            transform-origin: 0 0;
            z-index: 500;
            pointer-events: none;
        }
        
        /* 右侧面板 */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
            transition: all 0.3s ease;
        }
        
        .panel-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 22px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }
        
        .section-title {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--primary-color);
        }
        
        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(20, 40, 80, 0.5), rgba(10, 25, 50, 0.8));
            border-radius: 12px;
            padding: 18px;
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.critical {
            border-left-color: var(--danger-color);
        }
        
        .stat-card.warning {
            border-left-color: var(--warning-color);
        }
        
        .stat-card.success {
            border-left-color: var(--success-color);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: rgba(26, 115, 232, 0.2);
            color: var(--primary-color);
        }
        
        .stat-card.critical .stat-icon {
            background: rgba(229, 57, 53, 0.2);
            color: var(--danger-color);
        }
        
        .stat-card.warning .stat-icon {
            background: rgba(255, 179, 0, 0.2);
            color: var(--warning-color);
        }
        
        .stat-card.success .stat-icon {
            background: rgba(0, 200, 83, 0.2);
            color: var(--success-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .stat-trend {
            font-size: 0.85rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .trend-up {
            color: var(--danger-color);
        }
        
        .trend-down {
            color: var(--success-color);
        }
        
        /* 图表容器 */
        .chart-container {
            height: 200px;
            margin-top: 15px;
        }
        
        /* IP列表 */
        .ip-list-container {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .ip-list {
            list-style-type: none;
        }
        
        .ip-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(30, 60, 120, 0.3);
            border-radius: 10px;
            border-left: 4px solid var(--danger-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .ip-item:hover {
            background: rgba(40, 80, 160, 0.4);
            transform: translateX(5px);
        }
        
        .ip-address {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .ip-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ip-country {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .ip-threat {
            padding: 3px 8px;
            background: var(--danger-color);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* 攻击类型分布 */
        .attack-types {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .attack-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(30, 60, 120, 0.3);
            border-radius: 10px;
        }
        
        .attack-type-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .attack-type-bar {
            flex-grow: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }
        
        .attack-type-progress {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--danger-color), #ff6b6b);
        }
        
        /* 控制面板 */
        .control-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .control-btn {
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .control-btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
        }
        
        .control-btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #b71c1c);
            color: white;
            box-shadow: 0 5px 15px rgba(229, 57, 53, 0.4);
        }
        
        .control-btn-success {
            background: linear-gradient(135deg, var(--success-color), #00701a);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 200, 83, 0.4);
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        /* 攻击弹窗 */
        .attack-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(145deg, var(--darker-bg), #0a1929);
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(229, 57, 53, 0.6);
            border: 2px solid rgba(229, 57, 53, 0.5);
            animation: modal-appear 0.5s ease-out;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            background: rgba(229, 57, 53, 0.15);
            padding: 25px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(229, 57, 53, 0.3);
        }
        
        .modal-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .modal-title i {
            font-size: 3rem;
            color: var(--danger-color);
        }
        
        .modal-title h2 {
            font-size: 2.2rem;
            color: white;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: white;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .attack-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .attack-stat-card {
            background: rgba(20, 30, 60, 0.7);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border-top: 4px solid var(--danger-color);
        }
        
        .attack-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }
        
        .attack-stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }
        
        .defense-status {
            background: rgba(20, 30, 60, 0.7);
            padding: 30px;
            border-radius: 15px;
            margin-top: 25px;
            border-left: 5px solid var(--primary-color);
        }
        
        .defense-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .defense-header i {
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        .defense-header h3 {
            font-size: 1.8rem;
            color: white;
        }
        
        .defense-progress-container {
            margin: 25px 0;
        }
        
        .defense-progress-bar {
            height: 35px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 18px;
            overflow: hidden;
            position: relative;
        }
        
        .defense-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--primary-color));
            width: 100%;
            border-radius: 18px;
            transition: width 1s ease;
        }
        
        .defense-progress-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }
        
        .defense-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }
        
        .defense-detail-card {
            background: rgba(30, 60, 120, 0.4);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .defense-detail-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: white;
        }
        
        .defense-detail-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }
        
        .modal-footer {
            padding: 20px 30px;
            background: rgba(10, 15, 35, 0.9);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid rgba(255, 50, 50, 0.3);
        }
        
        /* 底部状态栏 */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 25, 41, 0.95);
            border-top: 1px solid var(--border-color);
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .status-items {
            display: flex;
            gap: 30px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-item-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .status-item-value {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .system-time {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        /* 帮助/教程弹窗 */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .help-content {
            background: linear-gradient(145deg, var(--darker-bg), #0a1929);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(26, 115, 232, 0.6);
            border: 2px solid rgba(26, 115, 232, 0.5);
            animation: modal-appear 0.5s ease-out;
            display: flex;
            flex-direction: column;
        }
        
        .help-header {
            background: rgba(26, 115, 232, 0.15);
            padding: 25px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(26, 115, 232, 0.3);
        }
        
        .help-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .help-title i {
            font-size: 3rem;
            color: var(--primary-color);
        }
        
        .help-title h2 {
            font-size: 2.2rem;
            color: white;
        }
        
        .help-body {
            padding: 30px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .help-section {
            margin-bottom: 25px;
            background: rgba(20, 30, 60, 0.3);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
        }
        
        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .help-section p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .help-hotkeys {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .hotkey-item {
            background: rgba(30, 60, 120, 0.4);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .hotkey-combo {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }
        
        .help-footer {
            padding: 20px 30px;
            background: rgba(10, 15, 35, 0.9);
            display: flex;
            justify-content: flex-end;
            border-top: 1px solid rgba(26, 115, 232, 0.3);
        }
        
        /* 动画定义 */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes attack-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        @keyframes server-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes server-under-attack {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 30px var(--danger-color);
            }
            50% { 
                transform: scale(1.2); 
                box-shadow: 0 0 50px var(--danger-color);
            }
        }
        
        @keyframes attack-marker-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px var(--danger-color); }
            50% { transform: scale(1.2); box-shadow: 0 0 25px var(--danger-color); }
        }
        
        @keyframes modal-appear {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes attack-line {
            0% { width: 0; opacity: 1; }
            100% { width: 100%; opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes particle-move {
            0% { 
                transform: translate(0, 0); 
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)); 
                opacity: 0;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
            
            .attack-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .right-panel {
                max-height: none;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .navbar-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .defense-details {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .status-items {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .hotkey-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(20, 40, 80, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        /* 工具提示 */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* 加载动画 */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 攻击线动画 */
        .attack-line-animation {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, var(--danger-color), transparent);
            transform-origin: 0 0;
            z-index: 500;
            pointer-events: none;
            animation: attack-line 1.5s linear forwards;
        }
        
        /* 全屏提示 */
        .fullscreen-hint {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            z-index: 3000;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        /* 黑客风格终端效果 */
        .hacker-terminal {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 999;
            display: none;
            max-width: 300px;
            border: 1px solid #00ff00;
        }
        
        .terminal-line {
            margin: 2px 0;
        }
        
        .terminal-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #00ff00;
            animation: blink 1s infinite;
            vertical-align: middle;
            margin-left: 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* 粒子控制面板 */
        .particle-controls {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            border: 1px solid var(--primary-color);
            display: none;
        }
        
        .particle-controls h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .particle-slider {
            margin: 10px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .slider-value {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        
        .particle-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* 防御粒子效果 */
        .defense-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 101;
            pointer-events: none;
            background-color: #00ff00;
            box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
        }
    </style>
</head>
<body>
    <!-- 背景粒子 -->
    <div id="background-particles"></div>
    
    <!-- 攻击粒子效果容器 -->
    <div id="attack-particles"></div>
    
    <!-- 全屏提示 -->
    <div class="fullscreen-hint" id="fullscreenHint">
        <i class="fas fa-expand-arrows-alt"></i> 按 ESC 键退出全屏模式
    </div>
    
    <!-- 粒子控制面板 -->
    <div class="particle-controls" id="particleControls">
        <h3><i class="fas fa-sliders-h"></i> 粒子效果控制</h3>
        
        <div class="particle-slider">
            <div class="slider-label">
                <span>粒子数量</span>
                <span class="slider-value" id="particleCountValue">50</span>
            </div>
            <input type="range" id="particleCountSlider" min="10" max="200" value="50">
        </div>
        
        <div class="particle-slider">
            <div class="slider-label">
                <span>粒子速度</span>
                <span class="slider-value" id="particleSpeedValue">5</span>
            </div>
            <input type="range" id="particleSpeedSlider" min="1" max="10" value="5">
        </div>
        
        <div class="particle-slider">
            <div class="slider-label">
                <span>粒子大小</span>
                <span class="slider-value" id="particleSizeValue">6</span>
            </div>
            <input type="range" id="particleSizeSlider" min="2" max="12" value="6">
        </div>
        
        <div class="particle-toggle">
            <span>攻击粒子</span>
            <label class="toggle-switch">
                <input type="checkbox" id="attackParticlesToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="particle-toggle">
            <span>防御粒子</span>
            <label class="toggle-switch">
                <input type="checkbox" id="defenseParticlesToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <button class="control-btn control-btn-primary" id="closeParticleControls" style="width: 100%; margin-top: 10px;">
            <i class="fas fa-times"></i> 关闭
        </button>
    </div>
    
    <!-- 黑客风格终端 -->
    <div class="hacker-terminal" id="hackerTerminal">
        <div class="terminal-line">> 初始化 DDoS 防御系统...</div>
        <div class="terminal-line">> 加载全球威胁情报数据库...</div>
        <div class="terminal-line">> 启动 500Gbps 防护层...</div>
        <div class="terminal-line">> 系统状态: <span style="color:#00ff00;">在线</span></div>
        <div class="terminal-line">> 等待指令... <span class="terminal-cursor"></span></div>
    </div>
    
    <div class="container">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="logo-text">
                    <h1>DDoS攻击监控与防御系统</h1>
                    <p>500Gbps+实时防护 | 全球威胁情报 | 智能缓解</p>
                </div>
            </div>
            
            <div class="navbar-controls">
                <button class="nav-btn help-btn" id="helpBtn">
                    <i class="fas fa-question-circle"></i> 帮助
                </button>
                <button class="nav-btn particle-btn" id="particleControlBtn">
                    <i class="fas fa-sliders-h"></i> 粒子效果
                </button>
                <button class="nav-btn" id="automateBtn">
                    <i class="fas fa-robot"></i> 自动模式
                </button>
                <button class="nav-btn fullscreen-btn" id="fullscreenBtn">
                    <i class="fas fa-expand-arrows-alt"></i> 全屏模式
                </button>
            </div>
            
            <div class="status-indicator" id="statusIndicator">
                <div class="status-dot"></div>
                <div class="status-text">
                    系统状态: <span id="statusText">正常运行</span>
                    <div class="status-details" id="statusDetails">所有服务器在线，网络状况良好</div>
                </div>
            </div>
        </nav>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 左侧地图区域 -->
            <div class="map-container">
                <div class="map-header">
                    <h2><i class="fas fa-globe-asia"></i> 全球DDoS攻击实时地图</h2>
                    <div class="map-controls">
                        <button class="map-btn" id="zoomInBtn">
                            <i class="fas fa-search-plus"></i> 放大
                        </button>
                        <button class="map-btn" id="zoomOutBtn">
                            <i class="fas fa-search-minus"></i> 缩小
                        </button>
                        <button class="map-btn" id="resetViewBtn">
                            <i class="fas fa-crosshairs"></i> 重置视图
                        </button>
                    </div>
                </div>
                <div id="map"></div>
            </div>
            
            <!-- 右侧监控面板 -->
            <div class="right-panel">
                <!-- 实时统计数据 -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3 class="section-title"><i class="fas fa-chart-line"></i> 实时统计数据</h3>
                        <span class="tooltip">
                            <i class="fas fa-info-circle" style="color: var(--text-secondary);"></i>
                            <span class="tooltiptext">实时更新DDoS攻击流量、拦截率和系统负载数据</span>
                        </span>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card critical" id="attackTrafficCard">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="attackTraffic">0 Gbps</div>
                                    <div class="stat-label">攻击流量峰值</div>
                                    <div class="stat-trend trend-up" id="attackTrend">
                                        <i class="fas fa-arrow-up"></i> <span>0%</span>
                                    </div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card success" id="blockedTrafficCard">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="blockedTraffic">0 Gbps</div>
                                    <div class="stat-label">已拦截流量</div>
                                    <div class="stat-trend trend-down" id="blockedTrend">
                                        <i class="fas fa-arrow-down"></i> <span>0%</span>
                                    </div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card warning" id="serverLoadCard">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="serverLoad">0%</div>
                                    <div class="stat-label">服务器负载</div>
                                    <div class="stat-trend" id="loadTrend">
                                        <i class="fas fa-minus"></i> <span>稳定</span>
                                    </div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-server"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card" id="attackCountCard">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="attackCount">0</div>
                                    <div class="stat-label">攻击IP数量</div>
                                    <div class="stat-trend trend-up" id="countTrend">
                                        <i class="fas fa-arrow-up"></i> <span>0%</span>
                                    </div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 流量图表 -->
                    <div class="chart-container">
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>
                
                <!-- 攻击源IP列表 -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3 class="section-title"><i class="fas fa-list"></i> 攻击源IP列表</h3>
                        <span class="tooltip">
                            <i class="fas fa-info-circle" style="color: var(--text-secondary);"></i>
                            <span class="tooltiptext">最近检测到的攻击源IP地址，按威胁等级排序</span>
                        </span>
                    </div>
                    
                    <div class="ip-list-container">
                        <ul class="ip-list" id="ipList">
                            <li class="ip-item">
                                <div class="ip-address">无活动攻击</div>
                                <div class="ip-info">
                                    <span class="ip-country">-</span>
                                    <span class="ip-threat" style="background: var(--success-color);">安全</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- 攻击类型分布 -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3 class="section-title"><i class="fas fa-project-diagram"></i> 攻击类型分布</h3>
                        <span class="tooltip">
                            <i class="fas fa-info-circle" style="color: var(--text-secondary);"></i>
                            <span class="tooltiptext">当前检测到的DDoS攻击类型及其比例分布</span>
                        </span>
                    </div>
                    
                    <div class="attack-types" id="attackTypes">
                        <div class="attack-type-item">
                            <div class="attack-type-name">
                                <i class="fas fa-exchange-alt"></i>
                                <span>SYN Flood</span>
                            </div>
                            <div class="attack-type-bar">
                                <div class="attack-type-progress" style="width: 0%"></div>
                            </div>
                            <span class="attack-type-percent">0%</span>
                        </div>
                        <div class="attack-type-item">
                            <div class="attack-type-name">
                                <i class="fas fa-broadcast-tower"></i>
                                <span>UDP Flood</span>
                            </div>
                            <div class="attack-type-bar">
                                <div class="attack-type-progress" style="width: 0%"></div>
                            </div>
                            <span class="attack-type-percent">0%</span>
                        </div>
                        <div class="attack-type-item">
                            <div class="attack-type-name">
                                <i class="fas fa-code"></i>
                                <span>HTTP Flood</span>
                            </div>
                            <div class="attack-type-bar">
                                <div class="attack-type-progress" style="width: 0%"></div>
                            </div>
                            <span class="attack-type-percent">0%</span>
                        </div>
                        <div class="attack-type-item">
                            <div class="attack-type-name">
                                <i class="fas fa-satellite-dish"></i>
                                <span>DNS Amplification</span>
                            </div>
                            <div class="attack-type-bar">
                                <div class="attack-type-progress" style="width: 0%"></div>
                            </div>
                            <span class="attack-type-percent">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- 控制面板 -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3 class="section-title"><i class="fas fa-gamepad"></i> 系统控制</h3>
                        <span class="tooltip">
                            <i class="fas fa-info-circle" style="color: var(--text-secondary);"></i>
                            <span class="tooltiptext">手动控制DDoS攻击模拟和系统响应</span>
                        </span>
                    </div>
                    
                    <div class="control-panel">
                        <button class="control-btn control-btn-danger" id="simulateAttackBtn">
                            <i class="fas fa-bolt"></i> 模拟攻击
                        </button>
                        <button class="control-btn control-btn-success" id="stopAttackBtn">
                            <i class="fas fa-stop"></i> 停止攻击
                        </button>
                        <button class="control-btn control-btn-primary" id="autoModeBtn">
                            <i class="fas fa-robot"></i> 自动模式
                        </button>
                        <button class="control-btn" id="fullReportBtn" style="background: linear-gradient(135deg, #9c27b0, #6a1b9a); color: white;">
                            <i class="fas fa-file-alt"></i> 生成报告
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 底部状态栏 -->
        <div class="status-bar">
            <div class="status-items">
                <div class="status-item">
                    <span class="status-item-label">系统运行时间:</span>
                    <span class="status-item-value" id="uptime">00:00:00</span>
                </div>
                <div class="status-item">
                    <span class="status-item-label">总拦截次数:</span>
                    <span class="status-item-value" id="totalBlocks">0</span>
                </div>
                <div class="status-item">
                    <span class="status-item-label">当前防护等级:</span>
                    <span class="status-item-value" id="protectionLevel">正常</span>
                </div>
                <div class="status-item">
                    <span class="status-item-label">数据中心状态:</span>
                    <span class="status-item-value" id="datacenterStatus">正常</span>
                </div>
            </div>
            <div class="system-time" id="systemTime">00:00:00</div>
        </div>
    </div>
    
    <!-- 攻击弹窗 -->
    <div class="attack-modal" id="attackModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h2>⚠️ DDoS攻击检测警告</h2>
                </div>
                <button class="modal-close" id="modalCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="attack-stats-grid">
                    <div class="attack-stat-card">
                        <div class="attack-stat-value" id="modalAttackVolume">0 Gbps</div>
                        <div class="attack-stat-label">攻击流量峰值</div>
                    </div>
                    <div class="attack-stat-card">
                        <div class="attack-stat-value" id="modalAttackIps">0</div>
                        <div class="attack-stat-label">攻击源IP数量</div>
                    </div>
                    <div class="attack-stat-card">
                        <div class="attack-stat-value" id="modalAttackType">SYN Flood</div>
                        <div class="attack-stat-label">主要攻击类型</div>
                    </div>
                    <div class="attack-stat-card">
                        <div class="attack-stat-value" id="modalAttackDuration">0s</div>
                        <div class="attack-stat-label">攻击持续时间</div>
                    </div>
                </div>
                
                <div class="defense-status">
                    <div class="defense-header">
                        <i class="fas fa-shield-alt"></i>
                        <h3>防御系统状态</h3>
                    </div>
                    <p>系统已自动启用500Gbps防护能力，正在实时拦截恶意流量，保护海南数据中心...</p>
                    
                    <div class="defense-progress-container">
                        <div class="defense-progress-bar">
                            <div class="defense-progress" id="defenseProgress" style="width: 100%"></div>
                            <div class="defense-progress-text" id="defenseProgressText">拦截成功率: 100%</div>
                        </div>
                    </div>
                    
                    <div class="defense-details">
                        <div class="defense-detail-card">
                            <div class="defense-detail-value" id="blockedIps">0</div>
                            <div class="defense-detail-label">已拦截IP数量</div>
                        </div>
                        <div class="defense-detail-card">
                            <div class="defense-detail-value" id="filteredPackets">0</div>
                            <div class="defense-detail-label">过滤数据包(亿)</div>
                        </div>
                        <div class="defense-detail-card">
                            <div class="defense-detail-value" id="responseTime">0ms</div>
                            <div class="defense-detail-label">系统响应时间</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="control-btn control-btn-success" id="enhanceDefenseBtn">
                    <i class="fas fa-shield-virus"></i> 增强防护
                </button>
                <button class="control-btn control-btn-primary" id="analyzeAttackBtn">
                    <i class="fas fa-search"></i> 深度分析
                </button>
                <button class="control-btn" id="closeModalBtn" style="background: rgba(255,255,255,0.1);">
                    <i class="fas fa-times"></i> 关闭警告
                </button>
            </div>
        </div>
    </div>
    
    <!-- 帮助/教程弹窗 -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <div class="help-header">
                <div class="help-title">
                    <i class="fas fa-question-circle"></i>
                    <h2>系统使用指南</h2>
                </div>
                <button class="modal-close" id="helpCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-body">
                <div class="help-section">
                    <h3><i class="fas fa-info-circle"></i> 系统概述</h3>
                    <p>这是一个模拟的DDoS攻击监控与防御系统，展示了现代网络安全系统的核心功能。系统模拟了500Gbps+的防护能力，实时监控全球攻击流量，并可视化防御过程。</p>
                    <p>所有数据均为模拟生成，不连接任何真实服务器或网络。系统用于展示DDoS攻击检测和防御的基本原理。</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-map-marked-alt"></i> 地图功能</h3>
                    <p>地图显示全球DDoS攻击源的实时分布：</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>绿色标记：海南数据中心位置</li>
                        <li>红色标记：攻击源位置</li>
                        <li>红色路径线：攻击流量方向</li>
                        <li>粒子效果：模拟攻击流量流向</li>
                        <li>点击标记查看详细信息</li>
                    </ul>
                    <p>使用地图控制按钮进行缩放、平移和重置视图操作。</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-atom"></i> 粒子攻击效果</h3>
                    <p>系统使用粒子效果模拟攻击流量：</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>攻击粒子</strong>：从全球攻击源飞向海南服务器的红色/橙色粒子</li>
                        <li><strong>防御粒子</strong>：从海南服务器向外扩散的绿色粒子，表示防御生效</li>
                        <li><strong>粒子控制</strong>：可以调整粒子数量、速度、大小和开关状态</li>
                        <li><strong>动态强度</strong>：粒子效果强度随攻击流量变化</li>
                    </ul>
                    <p>粒子效果直观展示了攻击流量的方向和强度，以及防御系统的响应。</p>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-chart-bar"></i> 监控面板</h3>
                    <p>右侧面板显示实时统计数据：</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>攻击流量峰值</strong>：当前检测到的最大攻击流量</li>
                        <li><strong>已拦截流量</strong>：防御系统成功拦截的流量</li>
                        <li><strong>服务器负载</strong>：海南数据中心当前负载情况</li>
                        <li><strong>攻击IP数量</strong>：检测到的攻击源IP总数</li>
                        <li><strong>攻击类型分布</strong>：不同类型攻击的比例</li>
                        <li><strong>攻击源IP列表</strong>：最近检测到的攻击IP详情</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-gamepad"></i> 控制功能</h3>
                    <p>使用控制面板模拟各种场景：</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>模拟攻击</strong>：手动触发DDoS攻击模拟</li>
                        <li><strong>停止攻击</strong>：结束当前攻击模拟</li>
                        <li><strong>自动模式</strong>：系统随机模拟攻击和防御</li>
                        <li><strong>生成报告</strong>：创建详细的攻击分析报告</li>
                        <li><strong>增强防护</strong>：提升防御系统等级</li>
                        <li><strong>深度分析</strong>：对攻击进行深度分析</li>
                        <li><strong>粒子效果</strong>：控制粒子效果的显示和参数</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-keyboard"></i> 快捷键</h3>
                    <div class="help-hotkeys">
                        <div class="hotkey-item">
                            <span>全屏模式</span>
                            <span class="hotkey-combo">F11 / Ctrl+Shift+F</span>
                        </div>
                        <div class="hotkey-item">
                            <span>模拟攻击</span>
                            <span class="hotkey-combo">Ctrl+Shift+A</span>
                        </div>
                        <div class="hotkey-item">
                            <span>停止攻击</span>
                            <span class="hotkey-combo">Ctrl+Shift+S</span>
                        </div>
                        <div class="hotkey-item">
                            <span>自动模式</span>
                            <span class="hotkey-combo">Ctrl+Shift+M</span>
                        </div>
                        <div class="hotkey-item">
                            <span>生成报告</span>
                            <span class="hotkey-combo">Ctrl+Shift+R</span>
                        </div>
                        <div class="hotkey-item">
                            <span>显示帮助</span>
                            <span class="hotkey-combo">F1</span>
                        </div>
                        <div class="hotkey-item">
                            <span>粒子控制</span>
                            <span class="hotkey-combo">Ctrl+Shift+P</span>
                        </div>
                        <div class="hotkey-item">
                            <span>退出全屏</span>
                            <span class="hotkey-combo">ESC</span>
                        </div>
                        <div class="hotkey-item">
                            <span>隐藏终端</span>
                            <span class="hotkey-combo">Ctrl+Shift+T</span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> 攻击模拟</h3>
                    <p>系统模拟多种DDoS攻击类型：</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>SYN Flood</strong>：利用TCP三次握手漏洞</li>
                        <li><strong>UDP Flood</strong>：发送大量UDP数据包</li>
                        <li><strong>HTTP Flood</strong>：针对Web服务器的HTTP请求攻击</li>
                        <li><strong>DNS Amplification</strong>：利用DNS服务器放大攻击流量</li>
                    </ul>
                    <p>防御系统会实时监控并拦截攻击，显示拦截成功率、响应时间等关键指标。</p>
                </div>
            </div>
            
            <div class="help-footer">
                <button class="control-btn control-btn-primary" id="closeHelpBtn">
                    <i class="fas fa-check"></i> 我知道了
                </button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Leaflet Marker Cluster -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    
    <!-- 粒子效果库 -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
        // ==================== 粒子攻击效果管理器 ====================
        class ParticleAttackManager {
            constructor() {
                this.attackParticles = [];
                this.defenseParticles = [];
                this.attackParticleInterval = null;
                this.defenseParticleInterval = null;
                this.isAttackParticlesEnabled = true;
                this.isDefenseParticlesEnabled = true;
                this.particleCount = 50;
                this.particleSpeed = 5;
                this.particleSize = 6;
                this.attackSources = [];
                this.hainanCoords = { x: 0, y: 0 };
                this.container = document.getElementById('attack-particles');
                this.mapContainer = document.getElementById('map');
                
                this.init();
            }
            
            init() {
                // 初始化攻击源位置（全球主要攻击地区）
                this.attackSources = [
                    { name: "美国", x: 0.25, y: 0.4, intensity: 0.8 },
                    { name: "俄罗斯", x: 0.6, y: 0.3, intensity: 0.7 },
                    { name: "德国", x: 0.48, y: 0.35, intensity: 0.6 },
                    { name: "日本", x: 0.75, y: 0.4, intensity: 0.9 },
                    { name: "巴西", x: 0.35, y: 0.7, intensity: 0.5 },
                    { name: "印度", x: 0.65, y: 0.5, intensity: 0.8 },
                    { name: "澳大利亚", x: 0.8, y: 0.8, intensity: 0.4 },
                    { name: "韩国", x: 0.72, y: 0.42, intensity: 0.7 },
                    { name: "越南", x: 0.68, y: 0.55, intensity: 0.6 },
                    { name: "菲律宾", x: 0.73, y: 0.58, intensity: 0.5 }
                ];
                
                // 海南服务器位置（地图中心偏右下方）
                this.hainanCoords = { x: 0.68, y: 0.48 };
                
                // 初始化粒子控制面板事件
                this.initParticleControls();
            }
            
            initParticleControls() {
                // 粒子控制按钮
                const particleControlBtn = document.getElementById('particleControlBtn');
                const particleControls = document.getElementById('particleControls');
                const closeParticleControls = document.getElementById('closeParticleControls');
                
                particleControlBtn.addEventListener('click', () => {
                    particleControls.style.display = particleControls.style.display === 'block' ? 'none' : 'block';
                });
                
                closeParticleControls.addEventListener('click', () => {
                    particleControls.style.display = 'none';
                });
                
                // 粒子数量滑块
                const particleCountSlider = document.getElementById('particleCountSlider');
                const particleCountValue = document.getElementById('particleCountValue');
                
                particleCountSlider.addEventListener('input', (e) => {
                    this.particleCount = parseInt(e.target.value);
                    particleCountValue.textContent = this.particleCount;
                });
                
                // 粒子速度滑块
                const particleSpeedSlider = document.getElementById('particleSpeedSlider');
                const particleSpeedValue = document.getElementById('particleSpeedValue');
                
                particleSpeedSlider.addEventListener('input', (e) => {
                    this.particleSpeed = parseInt(e.target.value);
                    particleSpeedValue.textContent = this.particleSpeed;
                });
                
                // 粒子大小滑块
                const particleSizeSlider = document.getElementById('particleSizeSlider');
                const particleSizeValue = document.getElementById('particleSizeValue');
                
                particleSizeSlider.addEventListener('input', (e) => {
                    this.particleSize = parseInt(e.target.value);
                    particleSizeValue.textContent = this.particleSize;
                });
                
                // 攻击粒子开关
                const attackParticlesToggle = document.getElementById('attackParticlesToggle');
                attackParticlesToggle.addEventListener('change', (e) => {
                    this.isAttackParticlesEnabled = e.target.checked;
                    if (!this.isAttackParticlesEnabled) {
                        this.clearAttackParticles();
                    }
                });
                
                // 防御粒子开关
                const defenseParticlesToggle = document.getElementById('defenseParticlesToggle');
                defenseParticlesToggle.addEventListener('change', (e) => {
                    this.isDefenseParticlesEnabled = e.target.checked;
                    if (!this.isDefenseParticlesEnabled) {
                        this.clearDefenseParticles();
                    }
                });
            }
            
            startAttackParticles(intensity = 1) {
                if (this.attackParticleInterval) {
                    clearInterval(this.attackParticleInterval);
                }
                
                if (!this.isAttackParticlesEnabled) return;
                
                // 根据强度调整粒子生成频率
                const frequency = Math.max(100, 500 - (intensity * 300));
                
                this.attackParticleInterval = setInterval(() => {
                    this.generateAttackParticles(intensity);
                }, frequency);
            }
            
            generateAttackParticles(intensity = 1) {
                if (!this.isAttackParticlesEnabled) return;
                
                // 根据强度调整粒子数量
                const count = Math.floor(this.particleCount * intensity);
                
                for (let i = 0; i < count; i++) {
                    // 随机选择一个攻击源
                    const source = this.attackSources[Math.floor(Math.random() * this.attackSources.length)];
                    
                    // 在攻击源附近随机生成起始位置
                    const startX = (source.x + (Math.random() - 0.5) * 0.05) * this.mapContainer.offsetWidth;
                    const startY = (source.y + (Math.random() - 0.5) * 0.05) * this.mapContainer.offsetHeight;
                    
                    // 目标位置（海南服务器）
                    const targetX = this.hainanCoords.x * this.mapContainer.offsetWidth;
                    const targetY = this.hainanCoords.y * this.mapContainer.offsetHeight;
                    
                    // 创建粒子
                    this.createAttackParticle(startX, startY, targetX, targetY, source.intensity * intensity);
                }
            }
            
            createAttackParticle(startX, startY, targetX, targetY, intensity) {
                const particle = document.createElement('div');
                particle.className = 'attack-particle';
                
                // 随机选择粒子颜色
                const colors = ['particle-red', 'particle-orange', 'particle-purple'];
                const colorClass = colors[Math.floor(Math.random() * colors.length)];
                particle.classList.add(colorClass);
                
                // 设置粒子大小
                const size = this.particleSize * (0.8 + Math.random() * 0.4);
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // 设置起始位置
                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;
                
                // 计算移动距离和方向
                const dx = targetX - startX;
                const dy = targetY - startY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const speed = this.particleSpeed * (0.8 + Math.random() * 0.4) * intensity;
                const duration = distance / speed;
                
                // 设置CSS变量用于动画
                particle.style.setProperty('--tx', `${dx}px`);
                particle.style.setProperty('--ty', `${dy}px`);
                
                // 设置动画
                particle.style.animation = `particle-move ${duration}ms linear forwards`;
                
                // 添加到容器
                this.container.appendChild(particle);
                this.attackParticles.push(particle);
                
                // 动画结束后移除粒子
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                        const index = this.attackParticles.indexOf(particle);
                        if (index > -1) {
                            this.attackParticles.splice(index, 1);
                        }
                    }
                }, duration);
            }
            
            startDefenseParticles(intensity = 1) {
                if (this.defenseParticleInterval) {
                    clearInterval(this.defenseParticleInterval);
                }
                
                if (!this.isDefenseParticlesEnabled) return;
                
                // 根据强度调整粒子生成频率
                const frequency = Math.max(200, 1000 - (intensity * 600));
                
                this.defenseParticleInterval = setInterval(() => {
                    this.generateDefenseParticles(intensity);
                }, frequency);
            }
            
            generateDefenseParticles(intensity = 1) {
                if (!this.isDefenseParticlesEnabled) return;
                
                // 根据强度调整粒子数量
                const count = Math.floor(this.particleCount * 0.5 * intensity);
                
                for (let i = 0; i < count; i++) {
                    // 从海南服务器位置开始
                    const startX = this.hainanCoords.x * this.mapContainer.offsetWidth;
                    const startY = this.hainanCoords.y * this.mapContainer.offsetHeight;
                    
                    // 随机生成目标方向（向外扩散）
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 200;
                    const targetX = startX + Math.cos(angle) * distance;
                    const targetY = startY + Math.sin(angle) * distance;
                    
                    // 创建防御粒子
                    this.createDefenseParticle(startX, startY, targetX, targetY, intensity);
                }
            }
            
            createDefenseParticle(startX, startY, targetX, targetY, intensity) {
                const particle = document.createElement('div');
                particle.className = 'defense-particle';
                
                // 设置粒子大小
                const size = this.particleSize * 0.8 * (0.8 + Math.random() * 0.4);
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // 设置起始位置
                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;
                
                // 计算移动距离和方向
                const dx = targetX - startX;
                const dy = targetY - startY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const speed = this.particleSpeed * 0.6 * (0.8 + Math.random() * 0.4) * intensity;
                const duration = distance / speed;
                
                // 设置CSS变量用于动画
                particle.style.setProperty('--tx', `${dx}px`);
                particle.style.setProperty('--ty', `${dy}px`);
                
                // 设置动画
                particle.style.animation = `particle-move ${duration}ms linear forwards`;
                
                // 添加到容器
                this.container.appendChild(particle);
                this.defenseParticles.push(particle);
                
                // 动画结束后移除粒子
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                        const index = this.defenseParticles.indexOf(particle);
                        if (index > -1) {
                            this.defenseParticles.splice(index, 1);
                        }
                    }
                }, duration);
            }
            
            updateParticleIntensity(intensity) {
                // 更新粒子效果强度
                if (this.attackParticleInterval) {
                    clearInterval(this.attackParticleInterval);
                    this.startAttackParticles(intensity);
                }
                
                if (this.defenseParticleInterval) {
                    clearInterval(this.defenseParticleInterval);
                    this.startDefenseParticles(intensity);
                }
            }
            
            stopAttackParticles() {
                if (this.attackParticleInterval) {
                    clearInterval(this.attackParticleInterval);
                    this.attackParticleInterval = null;
                }
                this.clearAttackParticles();
            }
            
            stopDefenseParticles() {
                if (this.defenseParticleInterval) {
                    clearInterval(this.defenseParticleInterval);
                    this.defenseParticleInterval = null;
                }
                this.clearDefenseParticles();
            }
            
            stopAllParticles() {
                this.stopAttackParticles();
                this.stopDefenseParticles();
            }
            
            clearAttackParticles() {
                this.attackParticles.forEach(particle => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                });
                this.attackParticles = [];
            }
            
            clearDefenseParticles() {
                this.defenseParticles.forEach(particle => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                });
                this.defenseParticles = [];
            }
            
            clearAllParticles() {
                this.clearAttackParticles();
                this.clearDefenseParticles();
            }
        }

        // ==================== 全屏功能实现 ====================
        class FullscreenManager {
            constructor() {
                this.isFullscreen = false;
                this.fullscreenBtn = document.getElementById('fullscreenBtn');
                this.fullscreenHint = document.getElementById('fullscreenHint');
                this.hackerTerminal = document.getElementById('hackerTerminal');
                this.terminalVisible = false;
                
                this.init();
            }
            
            init() {
                // 全屏按钮点击事件
                this.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());
                
                // 监听全屏变化
                document.addEventListener('fullscreenchange', () => this.handleFullscreenChange());
                document.addEventListener('webkitfullscreenchange', () => this.handleFullscreenChange());
                document.addEventListener('mozfullscreenchange', () => this.handleFullscreenChange());
                document.addEventListener('MSFullscreenChange', () => this.handleFullscreenChange());
                
                // 监听ESC键退出全屏
                document.addEventListener('keydown', (e) => this.handleKeydown(e));
                
                // 初始化终端显示
                setTimeout(() => {
                    this.hackerTerminal.style.display = 'block';
                    this.terminalVisible = true;
                }, 1000);
            }
            
            toggleFullscreen() {
                if (!this.isFullscreen) {
                    this.enterFullscreen();
                } else {
                    this.exitFullscreen();
                }
            }
            
            enterFullscreen() {
                const element = document.documentElement;
                
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
                
                // 显示全屏提示
                this.showFullscreenHint();
                
                // 更新按钮状态
                this.updateButtonState(true);
                
                // 添加全屏样式
                document.body.classList.add('fullscreen');
                
                // 触发地图重绘
                setTimeout(() => {
                    if (window.map) {
                        window.map.invalidateSize();
                    }
                }, 300);
            }
            
            exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                // 隐藏全屏提示
                this.hideFullscreenHint();
                
                // 更新按钮状态
                this.updateButtonState(false);
                
                // 移除全屏样式
                document.body.classList.remove('fullscreen');
                
                // 触发地图重绘
                setTimeout(() => {
                    if (window.map) {
                        window.map.invalidateSize();
                    }
                }, 300);
            }
            
            handleFullscreenChange() {
                this.isFullscreen = !!(document.fullscreenElement || 
                                     document.webkitFullscreenElement || 
                                     document.mozFullScreenElement || 
                                     document.msFullscreenElement);
                
                this.updateButtonState(this.isFullscreen);
                
                if (this.isFullscreen) {
                    document.body.classList.add('fullscreen');
                    this.showFullscreenHint();
                } else {
                    document.body.classList.remove('fullscreen');
                    this.hideFullscreenHint();
                }
                
                // 触发地图重绘
                setTimeout(() => {
                    if (window.map) {
                        window.map.invalidateSize();
                    }
                }, 300);
            }
            
            handleKeydown(e) {
                // ESC键退出全屏
                if (e.key === 'Escape' && this.isFullscreen) {
                    this.exitFullscreen();
                }
                
                // F11切换全屏
                if (e.key === 'F11') {
                    e.preventDefault();
                    this.toggleFullscreen();
                }
                
                // Ctrl+Shift+F切换全屏
                if (e.ctrlKey && e.shiftKey && e.key === 'F') {
                    e.preventDefault();
                    this.toggleFullscreen();
                }
                
                // Ctrl+Shift+T切换终端显示
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    this.toggleTerminal();
                }
                
                // Ctrl+Shift+P切换粒子控制面板
                if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                    e.preventDefault();
                    const particleControls = document.getElementById('particleControls');
                    particleControls.style.display = particleControls.style.display === 'block' ? 'none' : 'block';
                }
                
                // F1显示帮助
                if (e.key === 'F1') {
                    e.preventDefault();
                    document.getElementById('helpModal').style.display = 'flex';
                }
            }
            
            toggleTerminal() {
                this.terminalVisible = !this.terminalVisible;
                this.hackerTerminal.style.display = this.terminalVisible ? 'block' : 'none';
                
                // 显示通知
                this.showNotification(
                    this.terminalVisible ? "终端已显示" : "终端已隐藏",
                    this.terminalVisible ? "info" : "info"
                );
            }
            
            updateButtonState(fullscreen) {
                const icon = this.fullscreenBtn.querySelector('i');
                const text = fullscreen ? '退出全屏' : '全屏模式';
                
                if (fullscreen) {
                    icon.className = 'fas fa-compress-arrows-alt';
                    this.fullscreenBtn.innerHTML = `<i class="fas fa-compress-arrows-alt"></i> ${text}`;
                    this.fullscreenBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
                } else {
                    icon.className = 'fas fa-expand-arrows-alt';
                    this.fullscreenBtn.innerHTML = `<i class="fas fa-expand-arrows-alt"></i> ${text}`;
                    this.fullscreenBtn.style.background = 'linear-gradient(135deg, #9c27b0, #6a1b9a)';
                }
            }
            
            showFullscreenHint() {
                this.fullscreenHint.style.display = 'block';
                
                // 3秒后自动隐藏
                setTimeout(() => {
                    this.fullscreenHint.style.display = 'none';
                }, 3000);
            }
            
            hideFullscreenHint() {
                this.fullscreenHint.style.display = 'none';
            }
            
            showNotification(message, type = "info") {
                // 创建通知元素
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="position: fixed; top: 100px; right: 20px; background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : type === 'danger' ? 'rgba(229, 57, 53, 0.9)' : 'rgba(26, 115, 232, 0.9)'}; color: white; padding: 15px 20px; border-radius: 10px; z-index: 3000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); backdrop-filter: blur(10px); max-width: 300px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                            <span>${message}</span>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // 3秒后移除通知
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // ==================== 全局变量和配置 ====================
        const CONFIG = {
            HAINAN_COORDS: [20.0, 110.3], // 海南中心坐标
            INITIAL_ZOOM: 5, // 初始地图缩放级别
            MAX_ATTACK_VOLUME: 500, // 最大攻击流量 (Gbps)
            DEFENSE_CAPACITY: 500, // 防御能力 (Gbps)
            AUTO_ATTACK_PROBABILITY: 0.05, // 自动攻击概率 (5%)
            ATTACK_TYPES: [
                { name: "SYN Flood", color: "#e53935", icon: "fa-exchange-alt" },
                { name: "UDP Flood", color: "#ff6b6b", icon: "fa-broadcast-tower" },
                { name: "HTTP Flood", color: "#ff9800", icon: "fa-code" },
                { name: "DNS Amplification", color: "#9c27b0", icon: "fa-satellite-dish" },
                { name: "ICMP Flood", color: "#f44336", icon: "fa-network-wired" },
                { name: "Slowloris", color: "#795548", icon: "fa-hourglass-half" }
            ],
            COUNTRIES: [
                { name: "美国", coords: [39.8, -98.5], flag: "🇺🇸" },
                { name: "俄罗斯", coords: [61.5, 105.3], flag: "🇷🇺" },
                { name: "德国", coords: [51.2, 10.4], flag: "🇩🇪" },
                { name: "日本", coords: [36.2, 138.3], flag: "🇯🇵" },
                { name: "巴西", coords: [-14.2, -51.9], flag: "🇧🇷" },
                { name: "印度", coords: [20.6, 78.9], flag: "🇮🇳" },
                { name: "澳大利亚", coords: [-25.3, 133.8], flag: "🇦🇺" },
                { name: "韩国", coords: [36.0, 128.0], flag: "🇰🇷" },
                { name: "越南", coords: [16.0, 108.0], flag: "🇻🇳" },
                { name: "菲律宾", coords: [12.9, 122.9], flag: "🇵🇭" }
            ]
        };

        // 系统状态变量
        let isUnderAttack = false;
        let isAutoMode = false;
        let attackStartTime = null;
        let attackInterval = null;
        let defenseInterval = null;
        let systemUptime = 0;
        let totalBlocks = 0;
        
        // 攻击数据
        let attackData = {
            volume: 0, // 当前攻击流量 (Gbps)
            peakVolume: 0, // 峰值攻击流量
            ipCount: 0, // 攻击IP数量
            duration: 0, // 攻击持续时间 (秒)
            mainType: "SYN Flood", // 主要攻击类型
            typesDistribution: {}, // 攻击类型分布
            sourceIPs: [], // 攻击源IP列表
            attackPaths: [] // 攻击路径
        };
        
        // 防御数据
        let defenseData = {
            blockedVolume: 0, // 已拦截流量 (Gbps)
            blockedIPs: 0, // 已拦截IP数量
            filteredPackets: 0, // 过滤数据包数量 (亿)
            successRate: 100, // 拦截成功率 (%)
            responseTime: 5 // 响应时间 (ms)
        };
        
        // 系统性能数据
        let systemData = {
            serverLoad: 5, // 服务器负载 (%)
            networkLoad: 2, // 网络负载 (%)
            datacenterStatus: "normal", // 数据中心状态
            protectionLevel: "normal" // 防护等级
        };
        
        // 图表数据
        let trafficHistory = {
            labels: [],
            attackData: [],
            blockedData: []
        };
        
        // 地图相关变量
        let map = null;
        let hainanMarker = null;
        let attackMarkers = [];
        let attackLines = [];
        let markerCluster = null;
        
        // 管理器实例
        let particleAttackManager = null;
        let fullscreenManager = null;
        
        // DOM元素引用
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const statusDetails = document.getElementById('statusDetails');
        const simulateAttackBtn = document.getElementById('simulateAttackBtn');
        const stopAttackBtn = document.getElementById('stopAttackBtn');
        const autoModeBtn = document.getElementById('autoModeBtn');
        const attackModal = document.getElementById('attackModal');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const resetViewBtn = document.getElementById('resetViewBtn');
        const enhanceDefenseBtn = document.getElementById('enhanceDefenseBtn');
        const analyzeAttackBtn = document.getElementById('analyzeAttackBtn');
        const fullReportBtn = document.getElementById('fullReportBtn');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const helpCloseBtn = document.getElementById('helpCloseBtn');
        const closeHelpBtn = document.getElementById('closeHelpBtn');
        const automateBtn = document.getElementById('automateBtn');
        
        // 统计元素引用
        const attackTrafficEl = document.getElementById('attackTraffic');
        const blockedTrafficEl = document.getElementById('blockedTraffic');
        const serverLoadEl = document.getElementById('serverLoad');
        const attackCountEl = document.getElementById('attackCount');
        const attackTrendEl = document.getElementById('attackTrend');
        const blockedTrendEl = document.getElementById('blockedTrend');
        const loadTrendEl = document.getElementById('loadTrend');
        const countTrendEl = document.getElementById('countTrend');
        
        // 弹窗元素引用
        const modalAttackVolumeEl = document.getElementById('modalAttackVolume');
        const modalAttackIpsEl = document.getElementById('modalAttackIps');
        const modalAttackTypeEl = document.getElementById('modalAttackType');
        const modalAttackDurationEl = document.getElementById('modalAttackDuration');
        const defenseProgressEl = document.getElementById('defenseProgress');
        const defenseProgressTextEl = document.getElementById('defenseProgressText');
        const blockedIpsEl = document.getElementById('blockedIps');
        const filteredPacketsEl = document.getElementById('filteredPackets');
        const responseTimeEl = document.getElementById('responseTime');
        
        // 底部状态栏元素
        const uptimeEl = document.getElementById('uptime');
        const totalBlocksEl = document.getElementById('totalBlocks');
        const protectionLevelEl = document.getElementById('protectionLevel');
        const datacenterStatusEl = document.getElementById('datacenterStatus');
        const systemTimeEl = document.getElementById('systemTime');
        
        // ==================== 初始化函数 ====================
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化背景粒子
            initBackgroundParticles();
            
            // 初始化粒子攻击管理器
            particleAttackManager = new ParticleAttackManager();
            window.particleAttackManager = particleAttackManager;
            
            // 初始化全屏管理器
            fullscreenManager = new FullscreenManager();
            window.fullscreenManager = fullscreenManager;
            
            // 初始化地图
            initMap();
            
            // 初始化图表
            initCharts();
            
            // 初始化事件监听器
            initEventListeners();
            
            // 初始化攻击类型分布
            initAttackTypes();
            
            // 启动系统时钟
            startSystemClock();
            
            // 启动系统运行时间计数器
            startUptimeCounter();
            
            // 启动自动模式检查
            startAutoModeCheck();
            
            // 初始状态更新
            updateAllDisplays();
            
            // 控制台欢迎信息
            console.log(`
            ╔══════════════════════════════════════════════════════╗
            ║    DDoS攻击监控与防御系统 v4.0 已启动                ║
            ║                                                      ║
            ║  新增功能:                                           ║
            ║  • 粒子攻击效果模拟                                 ║
            ║  • 全球攻击流量可视化                               ║
            ║  • 动态粒子控制系统                                 ║
            ║  • 防御粒子效果展示                                 ║
            ║                                                      ║
            ║  系统状态: 正常运行                                 ║
            ║  粒子效果: 已启用                                   ║
            ║  全屏模式: ${fullscreenManager.isFullscreen ? '已开启' : '未开启'}                     ║
            ╚══════════════════════════════════════════════════════╝
            `);
            
            // 显示粒子效果提示
            setTimeout(() => {
                fullscreenManager.showNotification("粒子攻击效果已启用 - 模拟全球攻击流量", "info");
            }, 2000);
        });
        
        // ==================== 背景粒子初始化 ====================
        function initBackgroundParticles() {
            particlesJS('background-particles', {
                particles: {
                    number: { value: 60, density: { enable: true, value_area: 800 } },
                    color: { value: "#1a73e8" },
                    shape: { type: "circle" },
                    opacity: { value: 0.2, random: true },
                    size: { value: 2, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#1a73e8",
                        opacity: 0.1,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 0.5,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });
        }
        
        // ==================== 地图初始化 ====================
        function initMap() {
            // 创建地图实例
            map = L.map('map').setView(CONFIG.HAINAN_COORDS, CONFIG.INITIAL_ZOOM);
            window.map = map;
            
            // 添加地图图层 (使用OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18,
                minZoom: 2
            }).addTo(map);
            
            // 添加深色地图图层选项
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                maxZoom: 18,
                minZoom: 2
            }).addTo(map);
            
            // 创建标记聚类组
            markerCluster = L.markerClusterGroup({
                maxClusterRadius: 40,
                iconCreateFunction: function(cluster) {
                    const count = cluster.getChildCount();
                    let color = '#4CAF50';
                    if (count > 50) color = '#F44336';
                    else if (count > 20) color = '#FF9800';
                    else if (count > 10) color = '#FFC107';
                    
                    return L.divIcon({
                        html: `<div style="background-color:${color}; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; border:3px solid white;">${count}</div>`,
                        className: 'marker-cluster-custom',
                        iconSize: [40, 40]
                    });
                }
            });
            map.addLayer(markerCluster);
            
            // 添加海南服务器标记
            hainanMarker = L.marker(CONFIG.HAINAN_COORDS, {
                icon: L.divIcon({
                    html: '<div class="server-marker"><i class="fas fa-server"></i></div>',
                    iconSize: [40, 40],
                    className: 'server-marker-icon'
                })
            }).addTo(map);
            
            // 添加海南服务器弹出信息
            hainanMarker.bindPopup(`
                <div style="font-family: 'Segoe UI', sans-serif; padding: 10px;">
                    <h3 style="margin: 0 0 10px 0; color: #1a73e8;">海南数据中心</h3>
                    <p style="margin: 5px 0;"><strong>状态:</strong> <span style="color: #4CAF50;">● 在线</span></p>
                    <p style="margin: 5px 0;"><strong>防护等级:</strong> 500Gbps+</p>
                    <p style="margin: 5px 0;"><strong>服务器数量:</strong> 128台</p>
                    <p style="margin: 5px 0;"><strong>当前负载:</strong> <span id="popupLoad">5%</span></p>
                    <p style="margin: 5px 0;"><strong>IP地址:</strong> 112.74.xx.xx (伪装)</p>
                    <p style="margin: 5px 0;"><strong>地理位置:</strong> 中国海南省</p>
                    <p style="margin: 5px 0;"><strong>上线时间:</strong> 2023-06-15</p>
                </div>
            `);
            
            // 添加地图控制事件
            zoomInBtn.addEventListener('click', () => map.zoomIn());
            zoomOutBtn.addEventListener('click', () => map.zoomOut());
            resetViewBtn.addEventListener('click', () => map.setView(CONFIG.HAINAN_COORDS, CONFIG.INITIAL_ZOOM));
        }
        
        // ==================== 图表初始化 ====================
        let trafficChart = null;
        
        function initCharts() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            // 初始化历史数据
            const now = new Date();
            for (let i = 9; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60000);
                trafficHistory.labels.push(time.getHours().toString().padStart(2, '0') + ':' + time.getMinutes().toString().padStart(2, '0'));
                trafficHistory.attackData.push(0);
                trafficHistory.blockedData.push(0);
            }
            
            // 创建图表
            trafficChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: trafficHistory.labels,
                    datasets: [
                        {
                            label: '攻击流量 (Gbps)',
                            data: trafficHistory.attackData,
                            borderColor: '#e53935',
                            backgroundColor: 'rgba(229, 57, 53, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: '已拦截流量 (Gbps)',
                            data: trafficHistory.blockedData,
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#1a73e8',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                maxTicksLimit: 6
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b0b0b0',
                                callback: function(value) {
                                    return value + ' Gbps';
                                }
                            },
                            title: {
                                display: true,
                                text: '流量 (Gbps)',
                                color: '#b0b0b0'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    },
                    animations: {
                        tension: {
                            duration: 1000,
                            easing: 'linear'
                        }
                    }
                }
            });
        }
        
        // ==================== 事件监听器初始化 ====================
        function initEventListeners() {
            // 模拟攻击按钮
            simulateAttackBtn.addEventListener('click', startAttack);
            
            // 停止攻击按钮
            stopAttackBtn.addEventListener('click', stopAttack);
            
            // 自动模式按钮
            autoModeBtn.addEventListener('click', toggleAutoMode);
            
            // 自动按钮
            automateBtn.addEventListener('click', () => {
                toggleAutoMode();
                fullscreenManager.showNotification("自动模式已" + (isAutoMode ? "启用" : "禁用"), "info");
            });
            
            // 弹窗关闭按钮
            modalCloseBtn.addEventListener('click', () => attackModal.style.display = 'none');
            closeModalBtn.addEventListener('click', () => attackModal.style.display = 'none');
            
            // 增强防护按钮
            enhanceDefenseBtn.addEventListener('click', enhanceDefense);
            
            // 深度分析按钮
            analyzeAttackBtn.addEventListener('click', analyzeAttack);
            
            // 生成报告按钮
            fullReportBtn.addEventListener('click', generateReport);
            
            // 帮助按钮
            helpBtn.addEventListener('click', () => helpModal.style.display = 'flex');
            helpCloseBtn.addEventListener('click', () => helpModal.style.display = 'none');
            closeHelpBtn.addEventListener('click', () => helpModal.style.display = 'none');
            
            // 点击弹窗外部关闭
            attackModal.addEventListener('click', (e) => {
                if (e.target === attackModal) {
                    attackModal.style.display = 'none';
                }
            });
            
            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) {
                    helpModal.style.display = 'none';
                }
            });
        }
        
        // ==================== 攻击类型分布初始化 ====================
        function initAttackTypes() {
            // 初始化攻击类型分布数据
            CONFIG.ATTACK_TYPES.forEach(type => {
                attackData.typesDistribution[type.name] = 0;
            });
        }
        
        // ==================== 系统时钟 ====================
        function startSystemClock() {
            updateSystemTime();
            setInterval(updateSystemTime, 1000);
        }
        
        function updateSystemTime() {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                             now.getMinutes().toString().padStart(2, '0') + ':' + 
                             now.getSeconds().toString().padStart(2, '0');
            systemTimeEl.textContent = timeString;
        }
        
        // ==================== 系统运行时间计数器 ====================
        function startUptimeCounter() {
            setInterval(() => {
                systemUptime++;
                updateUptimeDisplay();
            }, 1000);
        }
        
        function updateUptimeDisplay() {
            const hours = Math.floor(systemUptime / 3600);
            const minutes = Math.floor((systemUptime % 3600) / 60);
            const seconds = systemUptime % 60;
            
            uptimeEl.textContent = 
                hours.toString().padStart(2, '0') + ':' + 
                minutes.toString().padStart(2, '0') + ':' + 
                seconds.toString().padStart(2, '0');
        }
        
        // ==================== 自动模式检查 ====================
        function startAutoModeCheck() {
            setInterval(() => {
                if (isAutoMode && !isUnderAttack && Math.random() < CONFIG.AUTO_ATTACK_PROBABILITY) {
                    startAttack();
                }
            }, 10000); // 每10秒检查一次
        }
        
        // ==================== 攻击模拟函数 ====================
        function startAttack() {
            if (isUnderAttack) return;
            
            isUnderAttack = true;
            attackStartTime = Date.now();
            
            // 更新状态指示器
            statusIndicator.classList.add('attack-detected');
            statusText.textContent = '遭受DDoS攻击';
            statusText.style.color = '#e53935';
            statusDetails.textContent = '检测到大规模攻击流量，防护系统已激活';
            
            // 更新服务器标记为被攻击状态
            if (hainanMarker) {
                const icon = hainanMarker.getIcon();
                icon.options.html = '<div class="server-marker under-attack"><i class="fas fa-server"></i></div>';
                hainanMarker.setIcon(icon);
            }
            
            // 初始化攻击数据
            attackData = {
                volume: 0,
                peakVolume: 0,
                ipCount: 0,
                duration: 0,
                mainType: CONFIG.ATTACK_TYPES[Math.floor(Math.random() * CONFIG.ATTACK_TYPES.length)].name,
                typesDistribution: {},
                sourceIPs: [],
                attackPaths: []
            };
            
            // 初始化攻击类型分布
            CONFIG.ATTACK_TYPES.forEach(type => {
                attackData.typesDistribution[type.name] = Math.random() * 20;
            });
            
            // 标准化攻击类型分布
            normalizeAttackTypes();
            
            // 显示攻击弹窗
            attackModal.style.display = 'flex';
            
            // 启动攻击更新循环
            attackInterval = setInterval(updateAttack, 1000);
            
            // 启动防御更新循环
            defenseInterval = setInterval(updateDefense, 500);
            
            // 在地图上添加攻击标记
            addAttackMarkers();
            
            // 启动粒子攻击效果
            particleAttackManager.startAttackParticles(0.5);
            particleAttackManager.startDefenseParticles(0.5);
            
            // 更新控制台
            console.log(`🔴 DDoS攻击已开始 - 类型: ${attackData.mainType}`);
            
            // 显示通知
            fullscreenManager.showNotification(`检测到${attackData.mainType}攻击，防御系统已激活`, "danger");
        }
        
        function updateAttack() {
            // 更新攻击持续时间
            attackData.duration = Math.floor((Date.now() - attackStartTime) / 1000);
            
            // 随机增加攻击流量 (0-30 Gbps)
            const increase = Math.random() * 30;
            attackData.volume = Math.min(CONFIG.MAX_ATTACK_VOLUME, attackData.volume + increase);
            
            // 记录峰值流量
            if (attackData.volume > attackData.peakVolume) {
                attackData.peakVolume = attackData.volume;
            }
            
            // 随机增加攻击IP数量
            attackData.ipCount = Math.min(500, Math.floor(attackData.ipCount + Math.random() * 10));
            
            // 随机更新攻击类型分布
            updateAttackTypesDistribution();
            
            // 添加新的攻击源IP
            addNewAttackIPs();
            
            // 更新地图攻击标记
            updateAttackMarkers();
            
            // 添加攻击路径动画
            addAttackPath();
            
            // 更新系统负载
            updateSystemLoad();
            
            // 更新所有显示
            updateAllDisplays();
            
            // 更新图表数据
            updateChartData();
            
            // 更新粒子效果强度
            const particleIntensity = Math.min(1, attackData.volume / CONFIG.MAX_ATTACK_VOLUME);
            particleAttackManager.updateParticleIntensity(particleIntensity);
            
            // 随机结束攻击 (5%概率)
            if (Math.random() < 0.05 && attackData.duration > 30) {
                stopAttack();
            }
        }
        
        function stopAttack() {
            if (!isUnderAttack) return;
            
            isUnderAttack = false;
            
            // 清除攻击间隔
            clearInterval(attackInterval);
            clearInterval(defenseInterval);
            
            // 更新状态指示器
            statusIndicator.classList.remove('attack-detected');
            statusText.textContent = '正常运行';
            statusText.style.color = '#e0e0ff';
            statusDetails.textContent = '攻击已缓解，系统恢复正常运行';
            
            // 恢复服务器标记正常状态
            if (hainanMarker) {
                const icon = hainanMarker.getIcon();
                icon.options.html = '<div class="server-marker"><i class="fas fa-server"></i></div>';
                hainanMarker.setIcon(icon);
            }
            
            // 隐藏攻击弹窗
            attackModal.style.display = 'none';
            
            // 清除地图上的攻击标记
            clearAttackMarkers();
            
            // 停止粒子攻击效果
            particleAttackManager.stopAllParticles();
            
            // 更新系统数据
            systemData.serverLoad = 5;
            systemData.networkLoad = 2;
            systemData.protectionLevel = "正常";
            
            // 更新总拦截次数
            totalBlocks += attackData.ipCount;
            totalBlocksEl.textContent = totalBlocks.toLocaleString();
            
            // 更新控制台
            console.log(`🟢 DDoS攻击已停止 - 持续时间: ${attackData.duration}秒, 峰值流量: ${attackData.peakVolume.toFixed(1)}Gbps`);
            
            // 显示通知
            fullscreenManager.showNotification(`攻击已缓解，拦截成功率${defenseData.successRate.toFixed(1)}%`, "success");
            
            // 重置攻击数据
            attackData.volume = 0;
            attackData.ipCount = 0;
            
            // 更新所有显示
            updateAllDisplays();
        }
        
        // ==================== 防御系统更新 ====================
        function updateDefense() {
            if (!isUnderAttack) return;
            
            // 计算拦截流量 (拦截80-99%的攻击流量)
            const blockRate = 0.8 + Math.random() * 0.19;
            defenseData.blockedVolume = attackData.volume * blockRate;
            
            // 计算拦截IP数量
            defenseData.blockedIPs = Math.min(attackData.ipCount, Math.floor(attackData.ipCount * blockRate));
            
            // 计算过滤数据包数量
            defenseData.filteredPackets = Math.floor(defenseData.blockedVolume * 1.5 * 100) / 100; // 转换为亿
            
            // 计算拦截成功率
            defenseData.successRate = Math.min(100, 95 + Math.random() * 5);
            
            // 计算响应时间
            defenseData.responseTime = Math.max(1, Math.floor(5 + Math.random() * 10));
            
            // 更新防御显示
            updateDefenseDisplay();
        }
        
        function enhanceDefense() {
            if (!isUnderAttack) return;
            
            // 增强防御效果
            defenseData.successRate = Math.min(100, defenseData.successRate + 5);
            defenseData.responseTime = Math.max(1, defenseData.responseTime - 2);
            
            // 增强粒子防御效果
            particleAttackManager.startDefenseParticles(1.5);
            
            // 更新系统防护等级
            systemData.protectionLevel = "增强";
            protectionLevelEl.textContent = "增强";
            
            // 显示增强提示
            fullscreenManager.showNotification("防护等级已提升至增强模式", "success");
            
            // 更新防御显示
            updateDefenseDisplay();
        }
        
        // ==================== 攻击类型分布更新 ====================
        function updateAttackTypesDistribution() {
            // 随机调整攻击类型分布
            CONFIG.ATTACK_TYPES.forEach(type => {
                const change = (Math.random() - 0.5) * 5;
                attackData.typesDistribution[type.name] = Math.max(0, attackData.typesDistribution[type.name] + change);
            });
            
            // 标准化
            normalizeAttackTypes();
            
            // 确定主要攻击类型
            let maxPercentage = 0;
            CONFIG.ATTACK_TYPES.forEach(type => {
                const percentage = attackData.typesDistribution[type.name];
                if (percentage > maxPercentage) {
                    maxPercentage = percentage;
                    attackData.mainType = type.name;
                }
            });
            
            // 更新攻击类型显示
            updateAttackTypesDisplay();
        }
        
        function normalizeAttackTypes() {
            // 计算总和
            let total = 0;
            CONFIG.ATTACK_TYPES.forEach(type => {
                total += attackData.typesDistribution[type.name];
            });
            
            // 标准化到100%
            if (total > 0) {
                CONFIG.ATTACK_TYPES.forEach(type => {
                    attackData.typesDistribution[type.name] = (attackData.typesDistribution[type.name] / total) * 100;
                });
            }
        }
        
        // ==================== 地图标记管理 ====================
        function addAttackMarkers() {
            // 添加初始攻击标记
            for (let i = 0; i < 10; i++) {
                addRandomAttackMarker();
            }
        }
        
        function addRandomAttackMarker() {
            // 随机选择一个国家作为攻击源
            const country = CONFIG.COUNTRIES[Math.floor(Math.random() * CONFIG.COUNTRIES.length)];
            
            // 在选定的国家内随机生成坐标
            const jitter = 5; // 坐标随机偏移范围
            const lat = country.coords[0] + (Math.random() - 0.5) * jitter;
            const lng = country.coords[1] + (Math.random() - 0.5) * jitter;
            
            // 创建攻击标记
            const marker = L.marker([lat, lng], {
                icon: L.divIcon({
                    html: '<div class="attack-marker"></div>',
                    iconSize: [20, 20],
                    className: 'attack-marker-icon'
                })
            });
            
            // 添加弹出信息
            const ip = generateRandomIP();
            const attackType = CONFIG.ATTACK_TYPES[Math.floor(Math.random() * CONFIG.ATTACK_TYPES.length)];
            
            marker.bindPopup(`
                <div style="font-family: 'Segoe UI', sans-serif; padding: 10px; min-width: 200px;">
                    <h4 style="margin: 0 0 10px 0; color: #e53935;">攻击源检测</h4>
                    <p style="margin: 5px 0;"><strong>IP地址:</strong> ${ip}</p>
                    <p style="margin: 5px 0;"><strong>地理位置:</strong> ${country.name} ${country.flag}</p>
                    <p style="margin: 5px 0;"><strong>攻击类型:</strong> ${attackType.name}</p>
                    <p style="margin: 5px 0;"><strong>威胁等级:</strong> <span style="color: #e53935;">高</span></p>
                    <p style="margin: 5px 0;"><strong>状态:</strong> <span style="color: #e53935;">● 活跃</span></p>
                    <hr style="margin: 10px 0; border-color: rgba(255,255,255,0.1);">
                    <p style="margin: 5px 0; font-size: 12px; color: #90a4ae;">已加入黑名单并开始流量清洗</p>
                </div>
            `);
            
            // 添加到标记聚类组
            markerCluster.addLayer(marker);
            attackMarkers.push(marker);
            
            // 添加到攻击源IP列表
            attackData.sourceIPs.push({
                ip: ip,
                country: country.name,
                flag: country.flag,
                type: attackType.name,
                threat: "高"
            });
        }
        
        function updateAttackMarkers() {
            // 随机添加或移除攻击标记
            if (Math.random() < 0.3 && attackMarkers.length < 50) {
                addRandomAttackMarker();
            }
            
            if (Math.random() < 0.1 && attackMarkers.length > 5) {
                removeRandomAttackMarker();
            }
        }
        
        function removeRandomAttackMarker() {
            if (attackMarkers.length === 0) return;
            
            const index = Math.floor(Math.random() * attackMarkers.length);
            const marker = attackMarkers[index];
            
            markerCluster.removeLayer(marker);
            attackMarkers.splice(index, 1);
        }
        
        function clearAttackMarkers() {
            attackMarkers.forEach(marker => {
                markerCluster.removeLayer(marker);
            });
            attackMarkers = [];
        }
        
        function addAttackPath() {
            if (attackMarkers.length === 0) return;
            
            // 随机选择一个攻击标记
            const sourceMarker = attackMarkers[Math.floor(Math.random() * attackMarkers.length)];
            const sourceCoords = sourceMarker.getLatLng();
            
            // 创建攻击路径
            const path = L.polyline([sourceCoords, CONFIG.HAINAN_COORDS], {
                color: '#e53935',
                weight: 2,
                opacity: 0.7,
                dashArray: '10, 10',
                className: 'attack-path'
            }).addTo(map);
            
            // 添加到攻击路径列表
            attackLines.push(path);
            
            // 5秒后移除路径
            setTimeout(() => {
                map.removeLayer(path);
                const index = attackLines.indexOf(path);
                if (index > -1) {
                    attackLines.splice(index, 1);
                }
            }, 5000);
        }
        
        // ==================== 系统负载更新 ====================
        function updateSystemLoad() {
            if (!isUnderAttack) return;
            
            // 根据攻击流量计算系统负载
            const attackRatio = attackData.volume / CONFIG.MAX_ATTACK_VOLUME;
            systemData.serverLoad = Math.min(95, 5 + attackRatio * 70 + Math.random() * 10);
            systemData.networkLoad = Math.min(90, 2 + attackRatio * 60 + Math.random() * 15);
            
            // 根据负载更新数据中心状态
            if (systemData.serverLoad > 80) {
                systemData.datacenterStatus = "高负载";
            } else if (systemData.serverLoad > 50) {
                systemData.datacenterStatus = "中等负载";
            } else {
                systemData.datacenterStatus = "正常";
            }
        }
        
        // ==================== 攻击源IP管理 ====================
        function addNewAttackIPs() {
            // 随机添加新的攻击源IP
            if (Math.random() < 0.4) {
                const country = CONFIG.COUNTRIES[Math.floor(Math.random() * CONFIG.COUNTRIES.length)];
                const attackType = CONFIG.ATTACK_TYPES[Math.floor(Math.random() * CONFIG.ATTACK_TYPES.length)];
                
                attackData.sourceIPs.push({
                    ip: generateRandomIP(),
                    country: country.name,
                    flag: country.flag,
                    type: attackType.name,
                    threat: Math.random() > 0.7 ? "极高" : "高"
                });
                
                // 保持列表不超过20个
                if (attackData.sourceIPs.length > 20) {
                    attackData.sourceIPs = attackData.sourceIPs.slice(-20);
                }
            }
        }
        
        function generateRandomIP() {
            return `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }
        
        // ==================== 显示更新函数 ====================
        function updateAllDisplays() {
            // 更新统计数据
            attackTrafficEl.textContent = attackData.volume.toFixed(1) + ' Gbps';
            blockedTrafficEl.textContent = defenseData.blockedVolume.toFixed(1) + ' Gbps';
            serverLoadEl.textContent = systemData.serverLoad.toFixed(1) + '%';
            attackCountEl.textContent = attackData.ipCount.toLocaleString();
            
            // 更新弹窗数据
            modalAttackVolumeEl.textContent = attackData.peakVolume.toFixed(1) + ' Gbps';
            modalAttackIpsEl.textContent = attackData.ipCount.toLocaleString();
            modalAttackTypeEl.textContent = attackData.mainType;
            modalAttackDurationEl.textContent = attackData.duration + 's';
            
            // 更新防御数据
            defenseProgressEl.style.width = defenseData.successRate + '%';
            defenseProgressTextEl.textContent = `拦截成功率: ${defenseData.successRate.toFixed(1)}%`;
            blockedIpsEl.textContent = defenseData.blockedIPs.toLocaleString();
            filteredPacketsEl.textContent = defenseData.filteredPackets.toFixed(2);
            responseTimeEl.textContent = defenseData.responseTime + 'ms';
            
            // 更新底部状态栏
            protectionLevelEl.textContent = systemData.protectionLevel;
            datacenterStatusEl.textContent = systemData.datacenterStatus;
            
            // 更新IP列表
            updateIPList();
            
            // 更新攻击类型显示
            updateAttackTypesDisplay();
            
            // 更新趋势指示器
            updateTrendIndicators();
        }
        
        function updateIPList() {
            const ipListEl = document.getElementById('ipList');
            ipListEl.innerHTML = '';
            
            if (attackData.sourceIPs.length === 0) {
                const li = document.createElement('li');
                li.className = 'ip-item';
                li.innerHTML = `
                    <div class="ip-address">无活动攻击</div>
                    <div class="ip-info">
                        <span class="ip-country">-</span>
                        <span class="ip-threat" style="background: var(--success-color);">安全</span>
                    </div>
                `;
                ipListEl.appendChild(li);
                return;
            }
            
            // 显示最近的攻击IP
            const recentIPs = attackData.sourceIPs.slice(-8).reverse();
            
            recentIPs.forEach(ipData => {
                const li = document.createElement('li');
                li.className = 'ip-item';
                
                let threatColor = '#e53935';
                if (ipData.threat === "极高") threatColor = '#b71c1c';
                
                li.innerHTML = `
                    <div class="ip-address">${ipData.ip}</div>
                    <div class="ip-info">
                        <span class="ip-country">${ipData.country} ${ipData.flag}</span>
                        <span class="ip-threat" style="background: ${threatColor};">${ipData.threat}</span>
                    </div>
                `;
                
                ipListEl.appendChild(li);
            });
        }
        
        function updateAttackTypesDisplay() {
            const attackTypesContainer = document.getElementById('attackTypes');
            const typeItems = attackTypesContainer.querySelectorAll('.attack-type-item');
            
            typeItems.forEach((item, index) => {
                if (index < CONFIG.ATTACK_TYPES.length) {
                    const type = CONFIG.ATTACK_TYPES[index];
                    const percentage = attackData.typesDistribution[type.name] || 0;
                    
                    const percentSpan = item.querySelector('.attack-type-percent');
                    const progressBar = item.querySelector('.attack-type-progress');
                    
                    percentSpan.textContent = percentage.toFixed(1) + '%';
                    progressBar.style.width = percentage + '%';
                    progressBar.style.background = `linear-gradient(90deg, ${type.color}, ${type.color}99)`;
                    
                    // 更新图标
                    const icon = item.querySelector('.fa');
                    if (icon) {
                        icon.className = `fas ${type.icon}`;
                    }
                }
            });
        }
        
        function updateDefenseDisplay() {
            // 防御显示在updateAllDisplays中已更新
        }
        
        function updateTrendIndicators() {
            // 简化趋势计算 - 在实际应用中，这里应该基于历史数据计算趋势
            if (isUnderAttack) {
                attackTrendEl.innerHTML = '<i class="fas fa-arrow-up"></i> <span>上升</span>';
                attackTrendEl.className = 'stat-trend trend-up';
                
                blockedTrendEl.innerHTML = '<i class="fas fa-arrow-up"></i> <span>上升</span>';
                blockedTrendEl.className = 'stat-trend trend-up';
                
                loadTrendEl.innerHTML = '<i class="fas fa-arrow-up"></i> <span>上升</span>';
                loadTrendEl.className = 'stat-trend trend-up';
                
                countTrendEl.innerHTML = '<i class="fas fa-arrow-up"></i> <span>上升</span>';
                countTrendEl.className = 'stat-trend trend-up';
            } else {
                attackTrendEl.innerHTML = '<i class="fas fa-minus"></i> <span>稳定</span>';
                attackTrendEl.className = 'stat-trend';
                
                blockedTrendEl.innerHTML = '<i class="fas fa-minus"></i> <span>稳定</span>';
                blockedTrendEl.className = 'stat-trend';
                
                loadTrendEl.innerHTML = '<i class="fas fa-minus"></i> <span>稳定</span>';
                loadTrendEl.className = 'stat-trend';
                
                countTrendEl.innerHTML = '<i class="fas fa-minus"></i> <span>稳定</span>';
                countTrendEl.className = 'stat-trend';
            }
        }
        
        // ==================== 图表数据更新 ====================
        function updateChartData() {
            const now = new Date();
            const timeLabel = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            
            // 添加新数据点
            trafficHistory.labels.push(timeLabel);
            trafficHistory.attackData.push(attackData.volume);
            trafficHistory.blockedData.push(defenseData.blockedVolume);
            
            // 保持数据长度不超过20个点
            if (trafficHistory.labels.length > 20) {
                trafficHistory.labels.shift();
                trafficHistory.attackData.shift();
                trafficHistory.blockedData.shift();
            }
            
            // 更新图表
            trafficChart.data.labels = trafficHistory.labels;
            trafficChart.data.datasets[0].data = trafficHistory.attackData;
            trafficChart.data.datasets[1].data = trafficHistory.blockedData;
            trafficChart.update();
        }
        
        // ==================== 辅助函数 ====================
        function toggleAutoMode() {
            isAutoMode = !isAutoMode;
            
            if (isAutoMode) {
                autoModeBtn.innerHTML = '<i class="fas fa-robot"></i> 自动模式(开)';
                autoModeBtn.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                fullscreenManager.showNotification("自动模式已启用，系统将随机模拟攻击", "info");
            } else {
                autoModeBtn.innerHTML = '<i class="fas fa-robot"></i> 自动模式';
                autoModeBtn.style.background = 'linear-gradient(135deg, #1a73e8, #0d47a1)';
                fullscreenManager.showNotification("自动模式已禁用", "info");
            }
        }
        
        function analyzeAttack() {
            fullscreenManager.showNotification("正在深度分析攻击模式...", "info");
            
            // 模拟分析过程
            setTimeout(() => {
                const analysis = {
                    topSource: CONFIG.COUNTRIES[Math.floor(Math.random() * CONFIG.COUNTRIES.length)].name,
                    attackPattern: "分布式多层攻击",
                    recommendedAction: "已自动优化防护规则",
                    estimatedEnd: "未来5-10分钟内"
                };
                
                fullscreenManager.showNotification(
                    `分析完成: 主要攻击源-${analysis.topSource}, 模式-${analysis.attackPattern}`, 
                    "success"
                );
            }, 2000);
        }
        
        function generateReport() {
            fullscreenManager.showNotification("正在生成攻击分析报告...", "info");
            
            // 模拟报告生成
            setTimeout(() => {
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(`
                    <html>
                    <head>
                        <title>DDoS攻击分析报告</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #1a73e8; }
                            .section { margin-bottom: 30px; }
                            table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                            th { background-color: #f2f2f2; }
                            .critical { color: #e53935; font-weight: bold; }
                            .success { color: #4CAF50; }
                        </style>
                    </head>
                    <body>
                        <h1>DDoS攻击分析报告</h1>
                        <p>生成时间: ${new Date().toLocaleString()}</p>
                        
                        <div class="section">
                            <h2>攻击概况</h2>
                            <table>
                                <tr><th>指标</th><th>数值</th></tr>
                                <tr><td>攻击峰值流量</td><td class="critical">${attackData.peakVolume.toFixed(1)} Gbps</td></tr>
                                <tr><td>攻击持续时间</td><td>${attackData.duration} 秒</td></tr>
                                <tr><td>攻击源IP数量</td><td>${attackData.ipCount}</td></tr>
                                <tr><td>主要攻击类型</td><td>${attackData.mainType}</td></tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <h2>防御效果</h2>
                            <table>
                                <tr><th>指标</th><th>数值</th></tr>
                                <tr><td>拦截成功率</td><td class="success">${defenseData.successRate.toFixed(1)}%</td></tr>
                                <tr><td>已拦截流量</td><td>${defenseData.blockedVolume.toFixed(1)} Gbps</td></tr>
                                <tr><td>已拦截IP数量</td><td>${defenseData.blockedIPs}</td></tr>
                                <tr><td>过滤数据包</td><td>${defenseData.filteredPackets.toFixed(2)} 亿</td></tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <h2>系统影响</h2>
                            <table>
                                <tr><td>服务器峰值负载</td><td>${systemData.serverLoad.toFixed(1)}%</td></tr>
                                <tr><td>数据中心状态</td><td>${systemData.datacenterStatus}</td></tr>
                                <tr><td>防护等级</td><td>${systemData.protectionLevel}</td></tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <h2>总结</h2>
                            <p>本次攻击已被成功缓解，系统保持稳定运行。防护系统有效拦截了${defenseData.successRate.toFixed(1)}%的攻击流量，确保了海南数据中心的可用性。</p>
                            <p>建议: 持续监控异常流量，定期更新防护规则。</p>
                        </div>
                    </body>
                    </html>
                `);
                reportWindow.document.close();
                
                fullscreenManager.showNotification("攻击分析报告已生成", "success");
            }, 1500);
        }
        
        // ==================== 键盘快捷键 ====================
        document.addEventListener('keydown', (e) => {
            // 全屏功能已经在FullscreenManager中处理
            
            // Ctrl+Shift+A: 模拟攻击
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                if (!isUnderAttack) {
                    startAttack();
                } else {
                    stopAttack();
                }
            }
            
            // Ctrl+Shift+S: 停止攻击
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                if (isUnderAttack) {
                    stopAttack();
                }
            }
            
            // Ctrl+Shift+M: 切换自动模式
            if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                toggleAutoMode();
            }
            
            // Ctrl+Shift+R: 生成报告
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                generateReport();
            }
            
            // Ctrl+Shift+P: 粒子控制面板
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                const particleControls = document.getElementById('particleControls');
                particleControls.style.display = particleControls.style.display === 'block' ? 'none' : 'block';
            }
            
            // F1: 显示帮助
            if (e.key === 'F1') {
                e.preventDefault();
                helpModal.style.display = 'flex';
            }
            
            // Escape: 关闭弹窗
            if (e.key === 'Escape') {
                if (attackModal.style.display === 'flex') {
                    attackModal.style.display = 'none';
                }
                if (helpModal.style.//Ctrl+Shift+P:粒子控制面板 === 'flex') {
                    如果.E.ctrl 键 = 'none';
                }
                E 换挡键 = E.键('particleControls');
                E
                    if (风格
                }
            }
        });
        
        E (E.攻击模式//Ctrl+Shift+P:粒子控制面板 if（E。ctrlKey&E。ShiftkEy&E。Key===='P'）{. const particleControls=document。getElementById('particleControls')；.//F1:mavolEcom===='block'）{. E===='F1'）{.帮助. Black.//Escape:mavolEcom='none'；='flex'； === 'Escape') {
        攻击模式 (显示.如果.帮助 === 'flex') {(() => {
            键.如果.风格 = 'none';.风格显示(显示.风格.常量帮助显示 === 'flex') {(控制键.文档如果.获取元素的帮助显示 = 'none';, "info");
        }, 5000);
        
        控制身份证 = 风格如果
        [显示提示：com
            P.显示+//显示快捷键提示）{setTimeout（you moveyou moveyou moveyou moveyou.showNotification（[youmbuSbuSbuSbuSctrl+Shift+P you joryou]，[0.1）；（）=>{/S
                etTimeout（）
                }, 5000);.这段代码是/随机启动低强度粒子效果 mayoto梅奥托梅奥托梅奥托马友）=[]；（setTimeout）=>{/
            }
        }, 3000);
    <JavaScript/ 中的语法，用于设置>
</如果受到攻击>
</}, 3000);>
